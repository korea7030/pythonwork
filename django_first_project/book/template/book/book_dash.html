{% extends 'book/base.html' %}

{% block content %}
<div class="row">
    <div id="category_content" class="col-xs-5" style="width:50%; height:400px;"></div>
    <div id="format_content" class="col-xs-5" style="width:50%; height:400px;"></div>
</div>
<div class="row">
    <div id="rating_content" class="col-xs-5" style="width:50%; height:400px;"></div>
    <div id="borrowed_content" class="col-xs-5" style="width:50%; height:400px;"></div>
</div>
<script type="text/javascript">
	$(document).ready(function() {
			var get_category = $.parseJSON('{{category_data|safe}}');
			var get_format = $.parseJSON('{{format_data|safe}}');
			var get_rating = $.parseJSON('{{rating_data|safe}}');
			var get_borrowed = $.parseJSON('{{borrowed_data|safe}}');

			var category_series = [];

			var format_series = [];
			var format_category = new Array();

			var rating_series = [];
			var rating_category = new Array();

			var borrowed_series = [];
			var borrowed_category = new Array();
			// 카테고리
			for (i = 0; i < get_category.name.length; i++) {
				// console.log(get_category.name[i]);
				category_series.push({
					name : get_category.name[i],
					y : get_category.data[i]
				})
			}

			// format
			for (j=0; j < get_format.name.length; j++) {
				// console.log(get_format.name[j]);
				format_category[j] = get_format.name[j];
				format_series.push({
					name : get_format.name[j],
					data : [get_format.data[j]]
				})
			}

			for (j=0; j < get_rating.name.length; j++) {
				// console.log(get_format.name[j]);
				rating_category[j] = get_rating.name[j];
				rating_series.push({
					name : get_rating.name[j],
					data : [get_rating.data[j]]
				})
			}

			console.log(get_borrowed);
			for (j=0; j < get_borrowed.name.length; j++) {
				// console.log(get_format.name[j]);
				borrowed_category[j] = get_borrowed.name[j];
				borrowed_series.push({
					name : get_borrowed.name[j],
					data : [get_borrowed.data[j]]
				})
			}
			console.log(borrowed_series);

		Highcharts.chart('category_content', {
		    chart: {
		        plotBackgroundColor: null,
		        plotBorderWidth: null,
		        plotShadow: false,
		        type: 'pie'
		    },
		    title: {
		        text: '카테고리 별 책 분포'
		    },
		    tooltip: {
		        formatter: function() {
        			return this.point.name + ' : ' + this.y + '권';
    			}
		    },
		    plotOptions: {
		        pie: {
		            allowPointSelect: true,
		            cursor: 'pointer',
		            dataLabels: {
		                enabled: true,
		                format: '<b>{point.name}</b>: {point.y} 권',
		                style: {
		                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
		                }
		            }
		        }
		    },
		    series: [{
		        data : category_series
		    }]
		});

		Highcharts.chart('format_content', {
		    chart: {
		        type: 'column'
		    },
		    title: {
		        text: '포맷별 권수'
		    },
		    xAxis: {
		        categories : format_category,
		        crosshair: true
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: '권수'
		        }
		    },
		    tooltip: {
		        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
		        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
		            '<td style="padding:0"><b>{point.y} 권</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0
		        }
		    },

		    series : format_series
		});

		Highcharts.chart('rating_content', {
		    chart: {
		        type: 'column'
		    },
		    title: {
		        text: '별점별 권수'
		    },
		    xAxis: {
		        categories : rating_category,
		        crosshair: true
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: '권수'
		        }
		    },
		    tooltip: {
		        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
		        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
		            '<td style="padding:0"><b>{point.y} 권</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0
		        }
		    },

		    series : rating_series
		});

		Highcharts.chart('borrowed_content', {
		    chart: {
		        type: 'column'
		    },
		    title: {
		        text: '빌린여부 분포'
		    },
		    xAxis: {
		        categories : borrowed_category,
		        crosshair: true
		    },
		    yAxis: {
		        min: 0,
		        title: {
		            text: '권수'
		        }
		    },
		    tooltip: {
		        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
		        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
		            '<td style="padding:0"><b>{point.y} 권</b></td></tr>',
		        footerFormat: '</table>',
		        shared: true,
		        useHTML: true
		    },
		    plotOptions: {
		        column: {
		            pointPadding: 0.2,
		            borderWidth: 0
		        }
		    },

		    series : borrowed_series
		});
	});


</script>
{% endblock %}